# 数学求解器优化报告

## 项目概述

本项目旨在优化数学求解器的性能，通过改进思维链(Chain of Thought)方法，提高模型在数学问题求解上的准确率。

## 改进措施

### 1. 思维链(COT)模板优化

#### 多样化思维链模板

我们实现了三种不同的思维链模板，在训练时随机选择：

1. **结构化分析模板**：
   ```
   让我逐步分析这个问题：
   1. 问题要求：...
   2. 已知条件：...
   3. 需要求解：...
   4. 解题思路：...
   5. 计算过程：...
   6. 答案：...
   ```

2. **教学式解题模板**：
   ```
   这是一个[问题类型]问题，我将一步步解决它。
   首先，我需要理解问题并提取关键信息。
   [问题分析...]
   现在我可以应用[相关公式/方法]：
   [解题步骤...]
   经过计算，答案是：...
   ```

3. **自问自答模板**：
   ```
   问题：[重述问题]？
   思考：我需要思考的是...
   我可以用什么方法解决呢？
   我可以尝试...
   让我计算一下...
   最终答案是：...
   ```

每次训练实例中随机选择一种模板，增加了模型对不同思维模式的适应能力，提高了泛化能力。

#### 强化系统提示

在每个模板中，我们都加入了以下关键元素，引导模型展示更完整的解题思路：

- 问题理解和分析部分
- 明确的公式推导过程
- 详细的计算步骤展示
- 结果验证环节
- 明确标识最终答案

#### 答题环节细化

将解题过程细分为多个环节，确保模型在每一步都有清晰的思考：
- 问题理解与分类
- 提取关键信息
- 选择解题策略
- 公式应用
- 数值计算
- 结果验证
- 答案格式化

### 2. 答案提取逻辑优化

#### 多层次正则表达式匹配

我们实现了一套层级化的答案提取机制：

1. **首选提取模式**：匹配"答案是："、"答案：" 或 "最终答案："后的数值
   ```python
   pattern1 = r'(?:答案是：|答案:|最终答案：)\s*([\d\.\-]+)'
   ```

2. **备用提取模式**：匹配结尾附近的数字回答
   ```python
   pattern2 = r'(?:结果为|计算得|等于|得到|结果是|答案为)\s*([\d\.\-]+)'
   ```

3. **最终回退模式**：提取文本中最后出现的数字
   ```python
   pattern3 = r'([\d\.\-]+)(?:[^数\d\.\-]*$)'
   ```

#### 特殊情况处理

- **带单位答案**：额外的正则表达式模式匹配带单位的答案
  ```python
  unit_pattern = r'([\d\.\-]+)\s*(?:米|千克|秒|平方米|立方米)'
  ```

- **分数答案**：识别形如"a/b"的分数格式
  ```python
  fraction_pattern = r'(\d+)/(\d+)'
  ```

- **LaTeX格式**：处理LaTeX数学表达式格式
  ```python
  latex_pattern = r'\$(.*?)\$'
  ```

- **科学计数法**：识别形如"1.2e-3"的科学记数法
  ```python
  scientific_pattern = r'([\d\.\-]+)[eE]([\+\-]?\d+)'
  ```

#### 回退策略

实现了多级回退策略，按优先级依次尝试不同提取方法：
1. 尝试从"答案是："标记中提取
2. 尝试从结尾位置反向寻找数字
3. 尝试从全文中提取所有数字并取最后一个
4. 尝试特殊格式识别（分数、带单位等）

## 实验结果

![1747634247541](image/Report/1747634247541.png)

- **基准模型(Baseline)得分**: 0.13
- **优化后模型得分**: 0.20
- **相对提升**: 53.8%

## 结论

通过思维链模板优化、训练参数调整和推理逻辑改进，数学求解器性能得到了显著提升。优化的Chain of Thought实现，能够更准确地解决数学问题，准确率提高了53.8%。

未来可继续探索更细致的领域适应训练以及更完善的答案提取逻辑，进一步提高模型性能。
 