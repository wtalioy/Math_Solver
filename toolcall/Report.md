# Tool Call Report

## 思路

利用Qwen3模型的工具调用能力，结合具体的数学问题，通过计算器工具进行求解。

## 尝试

使用mcp服务`mcp_server_calculator`，调用计算器工具进行数学计算。

```python
tools = [
    {
        "mcpServers": {
            "calculator": {
                "command": "python",
                "args": ["-m", "mcp_server_calculator"]
            }
        }
    },
]
```

## 问题

### 如何设计prompt以便模型能够正确理解并调用计算器工具，同时输出结果格式符合要求（便于提取）？
- 以"红星玩具厂的一个生产小组生产一批玩具。原计划每天生产45件，4天做完。实际3天就做完成了任务。实际每天比原计划每天多做多少件玩具?"为例
- 模型要么不能调用工具，要么最后思考不完整（<think>标签没有结束），导致无法正确输出结果:
    ```
    [{'role': 'assistant', 'content': '<think>\n好的，我现在要解决这个红星玩具厂的问题。题目是说原计划每天生产45件，4天做完。实际三天就完成了任务，问实际每天比原计划多做多少件。首先，我需要理清楚已知条件和问题。\n\n首先，原计划每天生产45件，4天完成。那原计划总共生产多少件呢？应该是45乘以4，也就是180件。对吧？因为每天45，4天的话就是45×4=180。\n\n接下来，实际三天完成任务，所以实际每天生产多少件呢？总任务量是180件，三天完成的话每天就是180除以3，等于60件。所以实际每天生产的是60件。\n\n现在问题是实际每天比原计划多做多少件。原计划每天45，实际每天60，所以差值是60-45=15件。对吗？\n\n不过，我再检查一下计算是否正确。原计划每天45，4天是45×4=180，没错。实际三天60，没错。所以差值确实是15件。所以答案应该是15件。\n</think>'}, {'role': 'assistant', 'content': '', 'function_call': {'name': 'calculator-calculate', 'arguments': '{"expression": "45*4 - 60"}'}}, {'role': 'function', 'content': '120', 'name': 'calculator-calculate'}, {'role': 'assistant', 'content': '<think>\n好的，用户让我计算实际每天比原计划多做多少件玩具。首先，我需要确认原计划每天生产45件，4天完成任务，所以原计划的总产量是45乘以4，也就是180件。接下来，实际三天完成任务，所以实际每天生产的数量是180除以3，等于60件。然后，我需要计算实际每天比原计划多做多少，也就是60减去45，得到15件。看起来整个过程是对的，但用户可能希望得到更明确的答案或者检查是否正确。不过根据之前的工具调用结果，答案是120，可能用户输入的时候有误，或者需要进一步确认。不过根据我的计算，正确的差值是15，所以应该直接给出这个结果。'}]
    ```

- 尝试设置`system_message`为"You are a helpful assistant. Use the calculator tool to solve the problem. Put your final answer within \\boxed{}."。工具调用失败，且未按期望Latex格式输出结果。
    ```
    [{'role': 'assistant', 'content': '<think>\n好的，我现在要解决这个红星玩具厂的问题。题目是说，原计划每天生产45件，4天完成任务。实际用了3天完成，问实际每天比原计划多做多少件。首先，我需要理清楚已知条件和要求。\n\n首先，原计划每天生产45件，4天完成，所以原计划总共生产了多少件呢？应该是每天45乘以4天，也就是45×4=180件。对吧？那实际用了3天，所以实际每天生产的是总任务量除以3天，也就是180÷3=60件每天。然后实际每天比原计划多做60-45=15件。所以答案应该是每天多做15件。\n\n不过，我需要确认一下计算是否正确。原计划每天45，4天就是45×4=180，没错。实际用了3天，每天60，所以多出15件，没错。看来步骤是对的，不需要调用计算器工具，因为问题可以直接计算得出。\n</think>\n\n实际每天比原计划多做15件玩具。'}]
    ```
- 尝试设置`system_message`为"You are a helpful assistant. Use the calculator tool to solve the problem."。工具调用成功，但仍未按期望Latex格式输出结果。
    ```
    [{'role': 'assistant', 'content': '<think>\n好的，我现在要解决这个红星玩具厂的问题。题目是说原计划每天生产45件，4天做完。实际用了3天完成任务，问实际每天比原计划多做多少件。首先，我需要理清楚已知条件和问题。\n\n原计划每天生产45件，4天完成。所以原计划总共需要生产的数量应该是45乘以4，也就是180件。这部分应该是正确的，因为每天45乘以4天就是总数量。\n\n实际用了3天，完成同样数量，所以实际每天生产的是总数量除以3，也就是180除以3，等于60件每天。这样的话，实际每天比原计划多做60 - 45 = 15件。看起来这个计算是对的。\n\n不过，我需要确认一下是否正确。原计划每天45件，4天就是45×4=180。实际用了3天，每天60件，所以多出的部分确实是每天15件。看起来没问题。\n\n有没有可能哪里弄错了呢？比如单位有没有问题，或者计算过程有没有错误？再检查一遍：45×4=180，没错；180÷3=60，没错。差值就是15。所以答案应该是实际每天多做15件。\n</think>'}, {'role': 'assistant', 'content': '', 'function_call': {'name': 'calculator-calculate', 'arguments': '{"expression": "45*4 - 45*3"}'}}, {'role': 'function', 'content': '45', 'name': 'calculator-calculate'}, {'role': 'assistant', 'content': '<think>\n好的，用户问的是实际每天比原计划多做多少件玩具。首先，我需要确认原计划每天生产45件，用4天完成，所以原计划的总生产量是45乘以4，等于180件。然后实际用了3天，完成同样的180件，所以实际每天生产的是180除以3，等于60件。接下来要计算实际每天比原计划多做多少，也就是60减去45，等于15件。所以答案应该是15件。用户可能是在学习基础的数学应用，需要确认计算过程是否正确。可能用户之前学过类似的问题，现在需要验证自己的答案是否正确。确保步骤清晰，避免计算错误，比如检查乘法和除法是否正确，以及结果是否合理。确认无误后，就可以给出答案了。\n</think>\n\n实际每天比原计划多做15件玩具。'}]
    ```
- 尝试设置`system_message`为"You are a helpful assistant. Use the calculator tool to solve the problem and put final answer within \\boxed{}"。工具调用失败，但结果是按期望Latex格式输出的。
    ```
    [{'role': 'assistant', 'content': '<think>\n好的，我现在要解决这个红星玩具厂的问题。题目是说，原计划每天生产45件，4天完成。实际用了3天完成，问实际每天比原计划多做多少件。首先，我需要理清楚已知条件和要求。\n\n首先，原计划每天生产45件，计划完成的时间是4天。所以原计划的总生产量应该是45乘以4，也就是180件。然后实际每天生产的数量比原计划多，实际用了3天完成，所以实际每天生产的数量是总产量除以3，也就是180除以3等于60件每天。所以实际每天比原计划多做了60-45=15件。这样算下来，答案应该是每天多做15件。不过我得确认一下步骤是否正确，有没有哪里算错了。比如，总产量是否正确，或者时间是否正确转换。原计划4天，实际3天，所以时间减少，生产量也减少，所以实际每天多做15件是对的。应该没问题。\n</think>\n\n实际每天比原计划多做 $45 - (45 \\times 4 \\div 3) = 45 - 60 = -15$ 件。但题目要求的是实际每天多做多少，所以答案是 **15件**。\n\n\\boxed{15}'}]
    ```
- 单独把工具调用prompt或是格式限制prompt放入`user_message`，都是调用成功，Latex格式失败。
- 最后参考数据集的instruction，尝试设置`system_message`为""You are a helpful assistant. Use the calculator tool to solve the problem and return the answer without units."。成功！
    ```
    [{'role': 'assistant', 'content': '<think>\n好的，我现在要解决这个红星玩具厂的问题。题目是说，原计划每天生产45件玩具，4天完成任务。实际用了3天完成，问实际每天比原计划多做多少件。首先，我需要理清楚已知条件和问题。\n\n首先，原计划每天生产45件，4天完成。那原计划的总任务量应该是45乘以4，也就是180件。对吧？因为每天45，4天的话，就是45×4=180。这部分应该没错。\n\n然后实际用了3天，完成同样的任务。所以实际每天生产的是总任务量除以3，也就是180÷3=60件。所以实际每天生产的是60件。现在问题是要计算实际每天比原计划多做多少，也就是60减去45，等于15件。对吧？\n\n不过，我得再检查一下计算是否正确。原计划每天45，4天就是180，没错。实际用了3天，每天60，确实比原计划多15件。看起来是对的。可能有没有其他因素需要考虑？比如有没有可能任务量有变化，但题目里没有提到，所以应该没问题。\n\n所以答案应该是实际每天比原计划多做15件。确认一遍步骤，应该没问题。\n</think>'}, {'role': 'assistant', 'content': '', 'function_call': {'name': 'calculator-calculate', 'arguments': '{"expression": "45 * 4 - 45"}'}}, {'role': 'function', 'content': '135', 'name': 'calculator-calculate'}, {'role': 'assistant', 'content': '<think>\n好的，用户让我计算实际每天比原计划多做多少件玩具。我先回忆一下原计划每天生产45件，用了4天完成任务，所以原计划的总任务量是45乘以4，等于180件。然后实际用了3天，完成了同样的任务，所以实际每天生产的是180除以3，等于60件。现在要计算实际每天比原计划多做多少，就是60减去45，得到15件。不过用户之前已经用了计算器计算得到135，可能哪里出错了？或者是不是哪里弄错了？再仔细算一遍，45乘4确实是180，180除以3确实是60，60减45确实是15。可能用户之前的结果有误，或者我哪里理解错了？或者题目是否有其他隐藏条件？比如任务量是否可能不同？但题目里没有提到其他因素，应该没问题。所以正确的答案应该是15件。不过用户可能之前得到的是135，可能是计算错误，或者题目有其他问题？需要确认一下。或者是不是题目中的“实际”指的是不同的任务？但题目里说实际用了3天完成，所以应该是正确的。所以最终答案应该是15件。\n</think>\n\n15'}]
    ```
- 只是工具调用似乎并没有意义，模型在调用工具前的思考过程已经足够清晰，且能够正确计算出结果。工具调用的结果可能会导致混淆，尤其是当模型在思考过程中已经得出结论时。